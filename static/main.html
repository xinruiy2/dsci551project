<html>

<style>
    .center {
        display: block;
        width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    table{
        width: 800px;
        margin-left: auto;
        margin-right: auto;
        border-collapse: collapse;
        border: 1px solid black;
    }

    th,td {
      font-size: 170%;
      border: 1px solid black;
      text-align: center;
    }

    select {
        width: 200px;
        height: 27px;
        vertical-align:text-bottom;
    }

    input.text{
        width: 200px;
        height: 27px;
        vertical-align:text-bottom;
    }

    input.textRange{
        width: 50px;
        height: 27px;
        vertical-align:text-bottom;
    }

    input.checkbox{
        width: 20px;
        height: 20px;
        vertical-align:text-bottom;
    }

    .submitBotton{
        width: 60px;
        height: 25px;
        tab-size: 30px;
        vertical-align:middle;
    }

    input[type="submit"]:hover, input[type="reset"]:hover {
                cursor:pointer;
                background-color: chartreuse;
    }


    input[type=number]::-webkit-inner-spin-button {
        opacity: 1
    }





    html {
        scroll-behavior: smooth;
    }

    button:hover {
    	cursor:pointer;
        background-color: chartreuse;
    }

    .shape{
        width: 1200px;
        margin-left: auto;
        margin-right:auto;
        margin-bottom: 5px;
        border: 1px solid black;
        background-color: #e7e7e7;
        border-radius: 5px;
        text-align: left;
        font-size: 18px
    }

    .shape:hover{
        box-shadow:0 0 10px #999;
    }
    
    /*button{
        display: block;
        margin-left: auto;
        margin-right: auto;
    }*/
    
    img.pic{
        border-color:darkgray;
        width: 120px;
        height: 120px;
        margin-left:30px;
        margin-top:20px;
        margin-right: 30px;
        float: left;
    }

    img.pic:hover{
        transform: scale(1.5);
    }

    B.s1{
        margin-left: 50px;
    }

    B.s2{
        margin-left: 180px;
    }

    B.s3{
        margin-left: 50px;
        font-weight: normal;
    }

     B.s4{
        margin-left: 180px;
        font-weight: normal;
    }

    div.all{
        display: none;
    }

    /* The slider itself */
    .slidecontainer {
      width: 25%; /* Width of the outside container */
      margin-left: auto;
      margin-right: auto;
    }

    .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 15px;
      border-radius: 5px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: #4CAF50;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: #4CAF50;
      cursor: pointer;
    }   
    
</style>    
    
  
<head> 
	<link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet"/>

    <script type="text/javascript">

    	search_data = [];
    	area_label = [];
    	area_value = [];


        function myfunc(input){
            let cl = document.getElementById("close" + input.toString());
            let part = document.getElementById("smhide" + input.toString());
            let lc = document.getElementById("loc" + input.toString());
            if(part.style.display == "none"){
                cl.style.display = "block";
                part.style.display = "block";
                lc.style.display = "block";
            }else{
                cl.style.display = "none";
                part.style.display = "none";
                lc.style.display = "none";
            }
        }

        function hideall(){
            var k = document.getElementById("hDIV");
            var t = document.getElementById("allDIV");
            k.style.display = "none";
            t.style.display = "none";
        }


        function myfunction(){
            var start_date = document.getElementById("start").value;
            var end_date = document.getElementById("end").value;

            var url = "/second?start="+start_date+"&end=" + end_date;

          
			if (document.getElementById("weather").value == "sky is clear" ){
				url+="&weather=sky is clear"
			}
			else if (document.getElementById("weather").value == "mist"){
				url+="&weather=mist"
			}
			else if (document.getElementById("weather").value == "few clouds"){
				url+="&weather=few clouds"
			}
			else if (document.getElementById("weather").value == "overcast clouds"){
				url+="&weather=overcast clouds"
			}
			else if (document.getElementById("weather").value == "scattered clouds"){
				url+="&weather=scattered clouds"
			}
			else if (document.getElementById("weather").value == "broken clouds"){
				url+="&weather=broken clouds"
			}
			else if (document.getElementById("weather").value == "light rain"){
				url+="&weather=light rain"
			}
			else if (document.getElementById("weather").value == "thunderstorm with rain"){
				url+="&weather=thunderstorm with rain"
			}
			else if (document.getElementById("weather").value == "moderate rain"){
				url+="&weather=moderate rain"
			}
			else if (document.getElementById("weather").value == "thunderstorm"){
				url+="&weather=thunderstorm"
			}
			else if (document.getElementById("weather").value == "shower rain"){
				url+="&weather=shower rain"
			}
			else if (document.getElementById("weather").value == "smoke"){
				url+="&weather=smoke"
			}
			else if (document.getElementById("weather").value == "drizzle"){
				url+="&weather=drizzle"
			}
			else if (document.getElementById("weather").value == "light intensity drizzle"){
				url+="&weather=light intensity drizzle"
			}
			else if (document.getElementById("weather").value == "heavy intensity rain"){
				url+="&weather=heavy intensity rain"
			}
			else if (document.getElementById("weather").value == "light intensity shower rain"){
				url+="&weather=light intensity shower rain"
			}
			else if (document.getElementById("weather").value == "very heavy rain"){
				url+="&weather=very heavy rain"
			}
			else if (document.getElementById("weather").value == "thunderstorm with light rain"){
				url+="&weather=thunderstorm with light rain"
			}
			else if (document.getElementById("weather").value == "proximity thunderstorm"){
				url+="&weather=proximity thunderstorm"
			}
			else if (document.getElementById("weather").value == "thunderstorm with heavy rain"){
				url+="&weather=thunderstorm with heavy rain"
			}
			else if (document.getElementById("weather").value == "squalls"){
				url+="&weather=squalls"
			}
			else if (document.getElementById("weather").value == "dust"){
				url+="&weather=dust"
			}
			else if (document.getElementById("weather").value == "proximity shower rain"){
				url+="&weather=proximity shower rain"
			}
            // document.getElementById("counter").innerHTML = url


			fetch(url)
				.then(response => response.json())
				//process the data
				.then(jsonData=>{
                    var table = [];
                    var area_dic = {};
                    for (date in jsonData) {
                    	for (hour in jsonData[date]) {
                    		for (area in jsonData[date][hour]) {
                    			var row = [date, hour, area, jsonData[date][hour][area]];
                    			table.push(row);

                    			if (area in area_dic){
                    				area_dic[area] += Number(jsonData[date][hour][area]);
                    			}
                    			else{
                    				area_dic[area] = Number(jsonData[date][hour][area]);
                    			}
                    		}
                    	}

                    }
                    search_data = table

					grid.updateConfig({
				        data: table
				    }).forceRender();


					area_label = [];
					area_value = [];
					for (key in area_dic){
						area_label.push(key);
						area_value.push(area_dic[key]);
					}

					myBarChart.data.labels = area_label;
				    myBarChart.data.datasets.forEach((dataset) => {
					    dataset.data = area_value
					});
				    myBarChart.update();

				    myPieChart.data.labels = area_label;
				    myPieChart.data.datasets.forEach((dataset) => {
					    dataset.data = area_value
					});
				    myPieChart.update();

				})
				.catch(function(err){alert(err)});

        }

        function filterfunction(){
        	hour = document.getElementById("hour").value;
        	data = search_data;
        	f_data = []
        	var area_dic = {};

        	data.forEach((item,index,array)=>{
        		if (item[1] == hour){
        			f_data.push(item);
        			// document.getElementById("tmd").innerHTML = item;
        			area = item[2];
        			if (area in area_dic){
        				area_dic[area] += item[3];
        			}
        			else{
        				area_dic[area] = item[3];
        			}
        		}
			})

        	grid.updateConfig({
				data: f_data
			}).forceRender();
			
			var f_area_label = [];
			var f_area_value = [];
			for (key in area_dic){
				f_area_label.push(key);
				f_area_value.push(area_dic[key]);
			}

			myBarChart.data.labels = area_label;
		    myBarChart.data.datasets.forEach((dataset) => {
			    dataset.data = f_area_value
			});
		    myBarChart.update();

		    myPieChart.data.labels = area_label;
		    myPieChart.data.datasets.forEach((dataset) => {
			    dataset.data = f_area_value
			});
		    myPieChart.update();
		}

		function nofilterfunction(){
			grid.updateConfig({
		        data: search_data
		    }).forceRender();


        	myBarChart.data.labels = area_label;
		    myBarChart.data.datasets.forEach((dataset) => {
			    dataset.data = area_value
			});
		    myBarChart.update();

		    myPieChart.data.labels = area_label;
		    myPieChart.data.datasets.forEach((dataset) => {
			    dataset.data = area_value
			});
		    myPieChart.update();
		}

    </script>
</head>

<body>

    <table>
        <form id = "inputInfo" method="GET" onsubmit="myfunction(); return false">
        <tr><td>
            <label>
                <B>Start date:</B>
                <input type="date" id = "start" name="Start" value="2017-06-01"/>
              </label>
                <tab></tab>
              <label>
                <B>End date:</B>
                <input type="date" id = "end" name="End" value="2017-06-01"/>
              </label>
        </td></tr>


        <tr><td> <B>Sort by:</B>
            <select name="weather" id="weather">
                <option value="sky is clear">sky is clear </option>
                <option value="mist">mist </option>
                <option value="fog">fog </option>
                <option value="haze">haze </option>
                <option value="few clouds">few clouds </option>
                <option value="overcast clouds">overcast clouds </option>
                <option value="scattered clouds">scattered clouds </option>
                <option value="broken clouds">broken clouds </option>
                <option value="light rain">light rain </option>
                <option value="thunderstorm with rain">thunderstorm with rain </option>
                <option value="moderate rain">moderate rain </option>
                <option value="thunderstorm">thunderstorm </option>
                <option value="shower rain">shower rain </option>
                <option value="smoke">smoke </option>
                <option value="drizzle">drizzle </option>
                <option value="light intensity drizzle">light intensity drizzle </option>
                <option value="heavy intensity rain">heavy intensity rain </option>
                <option value="light intensity shower rain">light intensity shower rain </option>
                <option value="very heavy rain">very heavy rain </option>
                <option value="thunderstorm with light rain">thunderstorm with light rain </option>
                <option value="proximity thunderstorm">proximity thunderstorm </option>
                <option value="thunderstorm with heavy rain">thunderstorm with heavy rain </option>
                <option value="squalls">squalls </option>
                <option value="dust">dust </option>
                <option value="proximity shower rain">proximity shower rain </option>

            </select>
        </td></tr>


        <tr><td> <input type="reset" value="Clear" class = "submitBotton" onclick = "hideall()"> <input type="submit" value="Search" class = "submitBotton">
            </td></tr>
        </form>
    </table>

    <!-- <div id = "counter"> </div> -->

    <div id = "hDIV" style = "display: none">
        <center><B ID = "totalnum" style = "font-size: 35px;"></B></center>
        <hr align="center" width="50%">
        </div>
        <div id = "allDIV" style= "display: none">
        <FIELDSET class = "shape" onclick = "myfunc(0)">
            <span id="close0" style="float:right; cursor: pointer; pointer-events: none; display: none;">❌</span>
            <img class = "pic" ID = "image0" border="2">
            <div style="display: inline-block; vertical-align: baseline">
                <br>
                <A ID = "titleh0" target="_blank"> <B ID = "title0"> </B></A>
                <br>
                <p><span> </span><I ID = "category0"></I><A ID = "iconh0" target="_blank"> <img src="redirect.png" width= "15px"><STYLE>A {text-decoration: none;} </STYLE> </A>
                <p><span ID="condition0"></span><img id="tr0" src="/static/topRatedImage.png" style="display:inline-block; width:22px; height:30px; display:none"></p>
                <div ID = "smhide0" style = "display: none;">
                <p> Seller <B ID = "ret0"></B> return </p>
                <p ID = "ship0"></p>
                </div>
                <p><B ID = "price0" style = "float: left"> </B> <I ID = "loc0" style = "display: none;"></I></p>
            </div>

        </FIELDSET>
        </div>

        <br>

	
	<div align="center">
		<div style="display: inline-block; vertical-align: top; margin-right: 30px;">
			<div id="wrapper"></div>
		    <script src="https://unpkg.com/gridjs/dist/gridjs.development.js"></script>
		    <script>
		    	const grid = new gridjs.Grid().updateConfig({
					columns: ["Date", "Hour", "Area", "Number of Collision"],
					data: [],
					sort: true,
					width: 'auto',
					search: {
						enabled: true
					},
					pagination: {
						enabled: true,
						limit: 10
						// summary: false
					},

					style: {
					    table: {
					      	'font-size': '10px',
					      	'align': 'center'
					    }
					    // footer: {
					    // 	'overflow': 'auto'
					    // }
					}
				}).render(document.getElementById("wrapper"));
		    </script>

		    <div>
		    	<B>Filted by hour: </B>
        		<select name="hour" id="hour" style="width: 60px; margin-top: 10px;">
	                <option value="00">00</option>
	                <option value="01">01 </option>
	                <option value="02">02 </option>
	                <option value="03">03 </option>
	                <option value="04">04 </option>
	                <option value="05">05 </option>
	                <option value="06">06 </option>
	                <option value="07">07 </option>
	                <option value="08">08 </option>
	                <option value="09">09 </option>
	                <option value="10">10 </option>
	                <option value="11">11 </option>
	                <option value="12">12 </option>
	                <option value="13">13 </option>
	                <option value="14">14 </option>
	                <option value="15">15 </option>
	                <option value="16">16 </option>
	                <option value="17">17 </option>
	                <option value="18">18 </option>
	                <option value="19">19 </option>
					<option value="20">20 </option>
	                <option value="21">21 </option>
	                <option value="22">22 </option>
	                <option value="23">23 </option>
	            </select>
        		<button onclick="filterfunction()">Filter</button>
        		<button onclick="nofilterfunction()">Clear</button>
		    </div>
		
		<!-- <div id="tmd"></div> -->
		</div>


	    <div class="chart-container"  style="position: relative; margin:0 auto; display: inline-block; vertical-align: top;"> 
		    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
	    	<canvas id="myBarChart"></canvas>
		  	<script>
		  		var color = ['rgba(255, 128, 128)', 'rgba(255, 159, 128)','rgba(255, 191, 128)','rgba(255, 223, 128)','rgba(255, 255, 128)','rgba(223, 255, 128)','rgba(191, 255, 128)','rgba(159, 255, 128)','rgba(128, 255, 128)','rgba(128, 255, 159)','rgba(128, 255, 191)','rgba(128, 255, 223)','rgba(128, 255, 255)'	,'rgba(128, 223, 255)','rgba(128, 204, 255)','rgba(128, 191, 255)','rgba(128, 159, 255)','rgba(255, 128, 255)','rgba(255, 128, 223)','rgba(255, 128, 191)', 'rgba(255, 128, 159)', 'rgba(255, 128, 128)'];
		  		var ctx1 = document.getElementById('myBarChart').getContext('2d');
			    var myBarChart = new Chart(ctx1, {
			        type: 'bar',
			        data: {
			            labels: ['No Data'],
			            datasets: [{
			                label: "# of Collision",
			                data: [0],
			                backgroundColor: color,
			                // borderColor: 'rgba(50,191,255)',
			                borderWidth: 1
			            }]
			        },
			        options: {
			            scales: {
			                yAxes: [{
			                    ticks: {
			                        beginAtZero: true
			                    }
			                }]
			            },
			            layout: {
				            padding: {
				                left: 40,
				                right: 50,
				                top: 0,
				                bottom: 0
				            }
				        }
			        }
			    });
			    myBarChart.canvas.parentNode.style.width = '600px';
	  		</script>
		
	    	<canvas id="myPieChart" style="margin-top: 30px;"></canvas>
			<script>
		  		var ctx2 = document.getElementById('myPieChart').getContext('2d');
			    var myPieChart = new Chart(ctx2, {
			        type: 'doughnut',
			        data: {
			            labels: ['No Data'],
			            datasets: [{
			                data: [0],
			                backgroundColor: color,
			                // borderColor: 'rgba(0,191,255, 1)',
			                borderWidth: 1
			            }]
			        },
			    });
			    myPieChart.canvas.parentNode.style.width = '600px';
	  		</script>
	  	</div>
	</div>

</body>
</html>
